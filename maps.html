<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<title>Google Maps V3 API Sample</title>
<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false"></script>

<script type="text/javascript" src="js/gmapsBoating.js"></script>

<script type="text/javascript">
var map;
var mapDiv;
var jumboEastCoast = new google.maps.LatLng(1.305189, 103.930657);
var floatAround = true


function driftPoly(ship, dv, angle) {
	var speed = Math.sqrt(200.0 / ship.__dims.length)
	var newAngle = (angle + Math.random() - 0.52) % 360	
	var newDv = coordThings.shiftMetric(dv, coordThings.makeVector(angle, speed))
	ship.updatePosition(newDv, newAngle)
	var chicken = 2 * 2 *(Math.random() - 0.5)
	ship.updateDomainParams(	Math.min(200, Math.max(10, ship.safetyRadius + chicken)), 
								Math.min(200, Math.max(0, ship.fwdDistance + chicken)),
								Math.min(45, Math.max(0, ship.fwdAngle + chicken))
								)
	ship.updatePolys()

	if (floatAround) {
		window.setTimeout(function(){driftPoly(ship, newDv, newAngle)}, 20)
	}
}

function floatABoat(length) {
	var ship = shipFactory.makeEZShip(shipFactory.makeShipDims(length, Math.pow(length,2.0/3.0)+1, length/10.0), jumboEastCoast)
	ship.updateDomainParams(length / 3.0, length / 8.0, 10)
	ship.putPolysOnMap(map)

	pos = coordThings.delta(Math.random()*1000 - 500, -100 - Math.random()*1000)
	angle = Math.random()*360
	driftPoly(ship, pos, angle)

	console.log(pos, angle)
	//return ship
}

function initialize() {
	mapDiv = document.getElementById('map-canvas');
	
	map = new google.maps.Map(mapDiv, {
		center: jumboEastCoast,
		zoom: 14,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	});
	var infoWindow = new google.maps.InfoWindow({
		position: jumboEastCoast,
		content: 'Jumbo Seafood East Coast'
	});
	infoWindow.open(map);	
	window.setTimeout(function(){
		infoWindow.close();
	}, 1000 )

	var lengths = [50, 100, 150, 200, 1000]
	lengths.forEach(function(length) {
		floatABoat(length) 
	} )
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>

<body>
	<div id="map-canvas" style="width: 800px; height: 400px"></div>
</body>


</html>
