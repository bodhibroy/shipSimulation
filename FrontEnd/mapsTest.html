<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<title>Google Maps V3 API Sample</title>
<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false"></script>

<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="js/gmapsBoating.js"></script>

<script type="text/javascript">
var map;
var mapDiv;
var jumboEastCoast = new google.maps.LatLng(1.305189, 103.930657);
var jumboEastCoastLobby = new google.maps.LatLng(1.305189, 103.930657 -  400.0 / 111319.9);
var floatAround = true


function driftPoly_old(ship, dv, angle, speed) {
	var newSpeed = Math.max(0, speed + Math.sqrt(200.0 / ship._dims.length) * (Math.random() - 0.5) * 0.1)
	var newAngle = (angle + Math.random() - 0.55) % 360	
	var newDv = coordThings.shiftMetric(dv, coordThings.makeVector(angle, newSpeed))
	ship.updatePosition(newDv, newAngle)
	ship.updateDomainParams(	ship.safetyRadius, 
								speed * 3 + ship._dims.fwd,
								Math.min(45, 25.0 / speed)
								)

	if (floatAround) {
		window.setTimeout(function(){driftPoly(ship, newDv, newAngle, newSpeed)}, 20)
	}
}

function driftPoly(ship, dv, angle, speed) {
	var newSpeed = Math.max(0, speed + Math.sqrt(200.0 / ship._dims.length) * (Math.random() - 0.5) * 0.1)
	var newAngle = (angle + Math.random() - 0.55) % 360	
	var newDv = coordThings.shiftMetric(dv, coordThings.makeVector(angle, newSpeed))
	ship.updatePosition(newDv, newAngle)
	ship.updateDomainParams()

	if (floatAround) {
		window.setTimeout(function(){driftPoly(ship, newDv, newAngle, newSpeed)}, 20)
	}
}

function floatABoat(length) {
	var ship = shipFactory.makeEZShip(shipFactory.makeShipDims(length, Math.pow(length,2.0/3.0)+1, length/20.0), jumboEastCoast)
	ship.updateDomainParams(length / 3.0, 4 * length / 3.0, 10, length / 6.0)
	ship.placeOnMap(map)

	var shipCol = misc.rgbToHex(Math.round(Math.random()*255), Math.round(Math.random()*255), Math.round(Math.random()*255))
	var domainCol = misc.rgbToHex(Math.round(Math.random()*255), Math.round(Math.random()*255), Math.round(Math.random()*255))
	ship.setShipPolyOptions(shipCol, shipCol, 0.8, 0.3)
	ship.setShipDomainPolyOptions(domainCol, domainCol, 0.3, 0.1)

	pos = coordThings.delta(Math.random()*1000 - 500, -100 - Math.random()*1000)
	angle = Math.random()*360
	speed = Math.sqrt(200.0 / ship._dims.length) * 2
	driftPoly(ship, pos, angle, speed)
	return ship
}

function floatAStationaryBoat(length, v, angle, safety_radius, fwd_distance, fwd_angle, RGB, baseLocation) {
	var ship
	if (baseLocation) {
	ship = shipFactory.makeEZShip(shipFactory.makeShipDims(length, Math.pow(length,2.0/3.0)+1, length/20.0), baseLocation)
	} else {
		ship = shipFactory.makeEZShip(shipFactory.makeShipDims(length, Math.pow(length,2.0/3.0)+1, length/20.0), jumboEastCoast)
	}
	ship.updatePosition(v, angle)
	ship.updateDomainParams(safety_radius, fwd_distance, fwd_angle)
	ship.placeOnMap(map)

	var shipCol = misc.rgbToHex(RGB.R, RGB.G, RGB.B)
	var domainCol = misc.rgbToHex(255, 0, 0)
	ship.setShipPolyOptions(shipCol, shipCol, 0.8, 0.3)
	ship.setShipDomainPolyOptions(domainCol, domainCol, 0.3, 0.1)

	return ship
}

var ships = []

function initialize() {
	mapDiv = document.getElementById('map-canvas');
	
	map = new google.maps.Map(mapDiv, {
		center: jumboEastCoast,
		zoom: 15,
		// mapTypeId: google.maps.MapTypeId.ROADMAP
		mapTypeId: google.maps.MapTypeId.HYBRID
		/*
		MapTypeId.ROADMAP displays the default road map view. This is the default map type.
		MapTypeId.SATELLITE displays Google Earth satellite images
		MapTypeId.HYBRID displays a mixture of normal and satellite views
		MapTypeId.TERRAIN displays a physical map based on terrain information.
		*/
	});
	var infoWindow = new google.maps.InfoWindow({
		position: jumboEastCoast,
		content: 'Jumbo Seafood East Coast'
	});
	infoWindow.open(map);	
	window.setTimeout(function(){
		infoWindow.close();
	}, 1000 )

	var lengths = [50, 100, 150, 200, 50, 100, 150, 200]
	lengths.forEach(function(length) {
		ships.push(floatABoat(length))
	} )


	//floatAround = false;
	shift_x = 650
	shift_y = -300
	ships.push(floatAStationaryBoat(100, coordThings.delta(500 + shift_x, -1000 + shift_y), 0, 20, 20, 12.5, {R: 128, G: 0, B: 255}))
	ships.push(floatAStationaryBoat(100, coordThings.delta(550 + shift_x, -900 + shift_y), -8, 20, 10, 20, {R: 0, G: 0, B: 255}))
	ships.push(floatAStationaryBoat(50, coordThings.delta(300 + shift_x, -950 + shift_y), 20, 10, 25, 10, {R: 0, G: 255, B: 0}))

	shift_x2 = shift_x + 400
	shift_y2 = shift_y + 200
	ships.push(floatAStationaryBoat(100, coordThings.delta(500 + shift_x2, -1000 + shift_y2), 0, 30, 0, 0, {R: 128, G: 0, B: 255}))
	ships.push(floatAStationaryBoat(100, coordThings.delta(550 + shift_x2, -900 + shift_y2), -8, 30, 0, 0, {R: 0, G: 0, B: 255}))
	ships.push(floatAStationaryBoat(50, coordThings.delta(300 + shift_x2, -950 + shift_y2), 20, 20, 5, 0, {R: 0, G: 255, B: 0}))


	ship1 = floatAStationaryBoat(100, coordThings.delta(700, -1500), 0, 30, 0, 0, {R: 128, G: 0, B: 255})
	ship2 = floatAStationaryBoat(200, coordThings.delta(800, -1550), 20, 30, 20, 10, {R: 0, G: 0, B: 255})
	ship3 = floatAStationaryBoat(200, coordThings.delta(800, -1550), 20, 30, 20, 10, {R: 0, G: 255, B: 255}, jumboEastCoastLobby)

	console.log(ship1.checkForDomainIntersection(ship2))
	console.log(ship2.checkForDomainIntersection(ship1))
	console.log(ship1.checkForDomainIntersection(ship3))
	console.log(ship2.checkForDomainIntersection(ship3))

	$.getJSON("testData.json", function( data ) {
		/*
		var items = [];
		alert(data)

		$.each( data, function( key, val ) {
	    	items.push( "<li id='" + key + "'>" + val + "</li>" );
		});
		$( "<ul/>", {
			"class": "my-new-list",
	    	html: items.join( "" )
	    }).appendTo( "body" );
		*/
	    console.log(data)
	});

}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>

<body>
	<div id="map-canvas" style="width: 1200px; height: 675px"></div>
</body>


</html>
