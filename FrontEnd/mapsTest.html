<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<title>Google Maps V3 API Sample</title>
<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false"></script>

<script type="text/javascript" src="js/gmapsBoating.js"></script>

<script type="text/javascript">
var map;
var mapDiv;
var jumboEastCoast = new google.maps.LatLng(1.305189, 103.930657);
var floatAround = true


function driftPoly(ship, dv, angle, speed) {
	var newSpeed = Math.max(0, speed + Math.sqrt(200.0 / ship._dims.length) * (Math.random() - 0.5) * 0.1)
	var newAngle = (angle + Math.random() - 0.55) % 360	
	var newDv = coordThings.shiftMetric(dv, coordThings.makeVector(angle, newSpeed))
	ship.updatePosition(newDv, newAngle)
	ship.updateDomainParams(	ship.safetyRadius, 
								speed * 3 + ship._dims.fwd,
								Math.min(45, 25.0 / speed)
								)

	if (floatAround) {
		window.setTimeout(function(){driftPoly(ship, newDv, newAngle, newSpeed)}, 20)
	}
}

function floatABoat(length) {
	var ship = shipFactory.makeEZShip(shipFactory.makeShipDims(length, Math.pow(length,2.0/3.0)+1, length/10.0), jumboEastCoast)
	ship.updateDomainParams(length / 4.0, length / 8.0, 10)
	ship.placeOnMap(map)

	var shipCol = misc.rgbToHex(Math.round(Math.random()*255), Math.round(Math.random()*255), Math.round(Math.random()*255))
	var domainCol = misc.rgbToHex(Math.round(Math.random()*255), Math.round(Math.random()*255), Math.round(Math.random()*255))
	ship.setShipPolyOptions(shipCol, shipCol, 0.8, 0.3)
	ship.setShipDomainPolyOptions(domainCol, domainCol, 0.3, 0.1)

	pos = coordThings.delta(Math.random()*1000 - 500, -100 - Math.random()*1000)
	angle = Math.random()*360
	speed = Math.sqrt(200.0 / ship._dims.length) * 2
	driftPoly(ship, pos, angle, speed)
	return ship
}

var ships = []

function initialize() {
	mapDiv = document.getElementById('map-canvas');
	
	map = new google.maps.Map(mapDiv, {
		center: jumboEastCoast,
		zoom: 15,
		// mapTypeId: google.maps.MapTypeId.ROADMAP
		mapTypeId: google.maps.MapTypeId.HYBRID
		/*
		MapTypeId.ROADMAP displays the default road map view. This is the default map type.
		MapTypeId.SATELLITE displays Google Earth satellite images
		MapTypeId.HYBRID displays a mixture of normal and satellite views
		MapTypeId.TERRAIN displays a physical map based on terrain information.
		*/
	});
	var infoWindow = new google.maps.InfoWindow({
		position: jumboEastCoast,
		content: 'Jumbo Seafood East Coast'
	});
	infoWindow.open(map);	
	window.setTimeout(function(){
		infoWindow.close();
	}, 1000 )

	var lengths = [50, 100, 150, 200, 50, 100, 150, 200]
	lengths.forEach(function(length) {
		ships.push(floatABoat(length))
	} )
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>

<body>
	<div id="map-canvas" style="width: 800px; height: 400px"></div>
</body>


</html>
